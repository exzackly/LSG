<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>lander</title>
    <script type="text/javascript"
            src = "simpleGame.js"></script>
    <script type="text/javascript">
    
    var scene;
    var lander;
    var blocks;
    var message = "";
    
    function Lander(){
        tLander = new Sprite(scene, "lander.png", 50, 50);
        tLander.setSpeed(0);
        tLander.imgDefault = "lander.png";
        tLander.imgUp = "landerUp.png";
        tLander.imgLeft = "landerLeft.png";
        tLander.imgRight = "landerRight.png"
        
        
        tLander.checkGravity = function(){
            if (this.falling){
              this.addVector(180, .1);
            } // end if
        } // end checkGravity
        
        tLander.checkKeys = function(){
            this.setImage(this.imgDefault);
            if (keysDown[K_UP]){
                this.setImage(this.imgUp);
                this.addVector(0, .3);
            } // end if
            
            if (keysDown[K_LEFT]){
                this.setImage(this.imgLeft);
				this.changeAngleBy(-3)
                //this.addVector(90, .1);
            } // end if
            
            if (keysDown[K_RIGHT]){
                this.setImage(this.imgRight);
				this.changeAngleBy(3)
                //this.addVector(270, .1);
            } // end if
            
        } // end checkKeys
        
        tLander.showStats = function(){
            //displays stats
            output = "DX: " + Math.round(this.dx * 10) + "<br />";
            output += "DY: " + Math.round(this.dy * 10) + "<br />";
            output += "ALT: " + Math.round(525 - this.y) + "<br />"
            output += "MSG: " + message;
            
            stats.innerHTML = output;
        } // end showStats
        
        tLander.checkBlock = function(block){
          if (this.collidesWith(block)) {
            message = "Oi!";
            return true;
          }
        } // end checkBlock
        
        return tLander;
    } // end Lander constructor
    
    function Block(x,y){
        tBlock = new Sprite(scene, "platform.png", 50, 50);
        tBlock.setSpeed(0);
        tBlock.setPosition(x,y);
        
        return tBlock;
    } // end platform constructor
    
    function printMap(map) {
      for (var i = 0; i < map.length; i++) {
        console.log(map[i]);
      }
    }

    function fillAdjacent(map, i, j) {
      
    }

    function generateMap(xSize, ySize, blockSize) {
      var map = new Array();
      var yLim = ySize/blockSize;
      var xLim = xSize/blockSize;
      for (var i = 0; i < yLim; i++) {
        var row = new Array();
        for (var j = 0; j < xLim; j++) {
           row.push(0); 
        }
        map.push(row);
      }

      for (var i = 0; i < yLim; i++) {
        for (var j = 0; j < xLim; j++) {
          if (map[i][j] == 0) {
            map[i][j] == 1;
          }
        }
      }

      return map;
    }

    function init(){
        scene = new Scene();
        scene.setSize(1000, 500);
        scene.setBG("black");
        lander = new Lander();
        blocks = new Array();

        var map = generateMap(1000, 500, 50);
        for (var i = 0; i < 3; i++) {
          blocks.push(new Block(25+i*100, 25));
        }
        stats = document.getElementById("stats");
        
        scene.start();
    } // end ini

    function updateBlocks() {
      for (var i = 0; i < blocks.length; i++) {
        blocks[i].update();
        if (lander.checkBlock(blocks[i])) {
          location.reload();
        }
      }
    }
    
    function update(){
        scene.clear();
        lander.checkGravity();
        lander.checkKeys();
        lander.showStats();
        updateBlocks();
        
        lander.update();
    } // end update
    
    </script>
    <style type="text/css">
        #stats {
            position: absolute;
            font-family: monospace;
            left: 50px;
            top: 50px;
            z-index: 999;
            color: white;
        }
    </style>
</head>
<body onload = "init()">
    <div id = "stats"></div>
</body>
</html>
